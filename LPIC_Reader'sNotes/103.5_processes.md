## 103.5 Processes
__weight 4__


### __ps__
- retorna um instantâneo dos processos da sessão atual;
- __opções:__
	- '-u username' retorna todos os processos para um usuário fornecido;
	- '-u username u' retorna todos os processos para um usuário, adicinando uma coluna descrevendo qual usuário iniciou o processo;
	- 'au' retorna todos os processos; caso a saída for muito longa, usa-se ```ps ua | less``` para o comando 'less' paginar a saída;
	- 'aux' inclui execuções do sistema;
	- 'auxf' indica com backslash \\ quais processos deram origem a outros processos;
	- 'axfl' adiciona uma coluna com o PID do processo 'pai' PPID;
	- para retornar dados de um determinado processo, pode-se filtrar seu nome com grep: 
		- ``` $ ps aux | grep -i processname ```
- __pstree__ retorna os processos em estrutura de árvore, feito o comando 'tree' para diretórios e arquivos;
	- 'pstree -p' inclui o PID dos processos.

### __top__
- um dashboard simples para monitoramento de processos no terminal;
- teclas para usar durante a execução do *top*:
	- 'z' altera a cor dos dados;
	- 'M' lista os processos que usam mais memória;
	- 'P' lista os processos que usam mais processamento;
	- 'L' permite digitar uma string com o nome de um processo a se localiar na lista;
	- 'q' para quit;
- __opções:__
	- *'-p PID'* mostra o processo pelo PID fornecido;
	- *'-u username'* mostra os processos de um determinado usuário.
	
### __pgrep *processname*__
- retorna o PID do processo fornecido.

### __pidof *exactprocessname*__
- retorna o PID do processo somente quando o nome fornecido está exatamente como o do processo desejado.

### __kill *PID*__
- força encerrar um processo pelo respetivo PID fornecido;
- pode ser utilizado com sinais, os quais são exibidos com a opção '-l';
- quando nenhum sinal é fornecido, o *kill* usa o sinal *15 SIGTERM* \(-term ou -15) por padrão;
- o sinal *kill* propriamente dito é o *9 SIGKILL* \(-kill ou -9): encerra imediatamente;
- o sinal *1 SIGHUP* \(-hup ou -1) reinicia o processo com eventuais novas configurações de um arquivo de configuração;
- o sinal *2 SIGINT* \(-int ou -2) interrompe o processo, feito o ctrl+c;
- o sinal *3 SIGQUIT* \(-quit ou -3) fecha o processo;
- o sinal *18 SIGCONT* \(-cont ou -18) solicita que o processo termine;
- o sinal *19 SIGSTOP* \(-stop ou -19) interrompe processo em execução;
- processos de um usuário qualquer só podem ser encerrados por ele mesmo ou pelo root;
- costuma-se usar a substituição de comando com pgrep, quando não se sabe o PID do processo, usando a seguinte sintaxe:
	- ``` # kill -9 $(pgrep processname) ```.

### __pkill *processname*__
- encerra um processo sem o PID, quando o nome do processo é fornecido.

### __killall *exactprocessname*__
- encerra todas instâncias de um processo sem o PID, mas somente quando o nome exato do processo é fornecido.

### __jobs__
- exibe os processos em segundo plano, inclusive os iniciados com o caracter especial '&' \(ver Special Characters);
- __opções__
	- '-l' lista os processos em segundo plano com o PID;
	- '-n' lista os que mudaram de status desde a última notificação;
	- '-p' lista os IDs dos processos;
	- '-r' lista apenas processos em execução;
	- '-s' lista apenas processos interrompidos \(suspensos);
	- '%n' lista um processo especificado pelo número ID jobspec 'n';
	- '%str' processo que começa por 'str';
	- '%?str' peocesso que contém 'str;
	- '%+' ou '%%' job atual, iniciado por último;
	- '%-' processo anterior.

### __fg %*ID*__
- fg seguindo de '%' e o número do processo em segundo plano \(bg), traz o processo para o primeiro plano;
- ctrl+z e '__bg %ID__' retornam o processo para o segundo plano.

### __nohup__
- mantém um comando em segundo plano ativo mesmo quando uma sessão é encerrada e reaberta:
``` $ nohup ping 8.8.8.8 & ```
- um arquivo 'nohup.out' é gerado no diretório da sessão; para o exemplo do ping, caso ele seja consultado com:
``` $ tailf nohup.out ``` os resultados do ping continuam sendo escritos;
- o processo poderá ser encerrado com:
```bash
$ pgrep ping
5542
$ kill -9 5542
```

### __free__
- retorna o consumo de memória RAM e SWAP pelo sistema;
- __opções:__
	- '-m' retorna em megabytes.

### __uptime__
- retorna informações da sessão de execução do sistema:
	- horário em que o comando foi executado;
	- up;
	- tempo em que o sistema está ligado nessa sessão;
	- quantidade de usuários logados;
	- load average: média de processos utilizando recursos nos últimos 1min., 5min., 15min.;
os números do 'load average' sinalizam a utilização dos recursos de um servidor que, caso permaneçam por muito tempo perto do valor '1', podem representar uma sobrecarga do sistema.
	
### __watch *command*__
- atualiza comandos periodicamente;
	- ``` # watch iptables -nvL ```
executa um reset do 'iptables -nvL', que exibe as regras de firewall, a cada dois segundos, que é o tempo padrão;
- encerra-se com ctrl+c;
- para configurar o intervalo de atualizações, usa-se:
	- ``` $ watch -n 10 command ```
em que 10 é o tempo em segundos que pode ser substituído pelo valor desejado;
- útil para monitorar a alteração de conteúdo de um arquivo em tempo real com o uso de ferramentas feito o comando 'cat'.

### __w__
- retorna usuários e sessões ativos no bash;
- podem-se ver sessões de multiplexadores.

### __screen__
- um multiplexer mais simples que o tmux, comentado a seguir;
	- '$ screen'; espaço ou enter iniciam uma nova sessão;
	- default prefix: ctrl+a
	- detach \(suspender sessão): ctrl+a +d
	- exibir sessões ativas: '$ screen -ls' 
	- retornar a uma sessão que seja a única: '$ screen -r'
	- retornar a uma sessão entre várias: '$ screen -s sessionname'
		ou '$ screen -s PID'
	- abrir outra janela: ctrl+a +c
	- alternar para a próxima janela: ctrl+a +n
	- alternar para a janelas anterior: ctrl+a +p
	- encerrar janela: ctrl+a +k ou 'exit'
	- encerrar sessão: ctrl+a +\

### __tmux__
- um multiplexer com mais recursos do que o 'screen';
	- default prefix: ctrl+b
	- abrir outra janela: ctrl+b +c
	- renomear janelas: ctrl+b +,
	- alternar para a próxima janela: ctrl+b +n
	- alternar para a janela anterior: ctrl+b +p
	- alternar para janela específica pelo número da janela: ctrl+b +2
	- alternar de janela com setas: ctrl+b +w
	- fechar janela: ctrl+b +&
	- detach session: ctrl+b +d
	- para exibir sessões ativas: '$ tmux -ls' 
	- renomear sessão: '$ tmux rename-session -t sessionnumber newsessionname'
	- para retornar a uma sessão ativa: '$ temux attach -t sessionname'
	- split pane vertically / horizontally: ctrl+b +% / : ctrl+b +" 
	- mover entre painéis: ctrl+b +arrows
	- fechar painéis: ctrl+b +x
	- encerrar sessão única: '$ tmux kill-session'
	- encerrar uma sessão entre várias: '$ tmux kill-session -t sessionname'


## Special Characters
	
	
### __&__ Ampersand \(e comercial)
- executa um comando em segundo plano, com a sintaxe de exemplo:
```bash
$ less filename &
[1] 5481
```
em que o '\[1]' retornado é a identificação como primeiro processo da sessão em 
segundo plano e o '5481' é o PID;
