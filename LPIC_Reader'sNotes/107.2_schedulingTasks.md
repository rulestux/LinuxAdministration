## 107.2 Scheduling Tasks
__weight 4__


### cron
- daemon que verifica, a cada minuto, tabelas de tarefas a executar, chamadas '__crontabs__', contendo '__cron jobs__';
- normalmente o modelo dos crontabs é o arquivo '/etc/crontab';

- __Crontabs de Usuário:__
	- geralmente encontrados em '/var/spool/cron/';
	- contém 6 campos separados por espaço:
		- minuto da hora: 0-59;
		- hora do dia: 0-23;
		- dia do mês: 1-31;
		- mês do ano: 1-12;
		- dia da semana: 0-7, podendo o domingo ser 0 ou 7;
		- comando a executar;
	- o preenchimento dos campos aceita asterisco '*' como sinal de qualquer valor, vírgula ',' separando valores possíveis, hífen '-' especificando um intervalo e barra '/' para valores escalonados \(com intervalos inseridos);

- __Crontabs de Sistema:__
	- '/etc/crontab' e os arquivos em '/etc/cron.d' são crontabs de sistema e só podem ser alterados pelo root;
	- algumas distros possuem também os diretórios: 
		- '/etc/cron.hourly', 
		- '/etc/cron.daily',
		- '/etc/cron.weekly' e 
		- '/etc/cron.monthly', 
	- nesses diretórios podem ser colocados crontabs para serem executados na frequência equivalente; estes mesmos diretórios também podem ter o nome '/etc/cron.d/hourly' etc.;
	- os crontabs de sistema contêm 7 campos separados por espaço, porque especificam o nome do usuário cuja conta irá executar o comando:
		- minuto da hora: 0-59;
		- hora do dia: 0-23;
		- dia do mês: 1-31;
		- mês do ano: 1-12;
		- dia da semana: 0-7, podendo o domingo ser 0 ou 7;
		- nome do usuário cuja conta irá executar o comando;
		- comando a executar;

- __especificações de tempo:__
	- podem substituir as cinco primeiras colunas no crontab:
		- @reboot: roda a tarefa uma vez após a reinicialização;
		- @hourly: a cada hora;
		- @daily ou @midnight: a cada 00:00h;
		- @monthly: a cada 00:00h do primeiro dia de cada mês;
		- @yearly: a cada 00:00h do primeiro dia de cada ano;

- __variáveis no crontab:__
	- HOME: diretório inicial do usuário em que o cron invoca os comandos;
	- MAILTO: nome de usuário ou endereço para o qual são enviadas as saídas de erro padrão; podem-se configurar diversos valores separados por vírgula;
	- PATH: caminho em que os comandos são encontrados;
	- SHELL: shell a ser usado;

- __controle de uso:__
	- os arquivos '/etc/cron.allow' e '/etc/cron.deny' listam usuários que têm permissão ou não para agendar tarefas.

### crontab
- comando usado administrar arquivos crontab de usuário;
- crontabs de sistema são administrados diretamente nos diretórios respectivos, conforme acima;
- __opções:__
	- '-e' cria ou edita um arquivo crontab usando um editor selecionado no primeiro uso ou configurado em variáveis de ambiente feito VISUAL ou EDITOR;
	- '-l' exibe o crontab atual;
	- '-r' remove o crontab atual;
	- '-u' permite especificar um usuário cujo crontab será modificado.

### anacron
- agendador de tarefas assíncronas que executa tarefas pendentes, com verificação apenas em intervalos diários;
- não há agendamentos por usuário, apenas por sistema, feitos no arquivo '/etc/anacrontab';
- são apenas 5 colunas, especificando o dia, o delay, a frequência do agendamento cron equivalente, o comando 'run-parts --report' e o diretório cron equivalente.

### at
- comando que agenda tarefas únicas, para o daemon 'atd', cujo status é verificado com 'systemctl status atd';
- o comando abre um prompt para inserção de comandos a executar que é encerrado por ctrl+D;
- tem como equivalente o comando 'batch', que trabalha em carga baixa de sistema;
- __sintaxe:__
 ```$ at HOUR:MIN DD.MM.YY```
	- em que a data e hora podem ser substituídas por palavras reservadas como:
		- teatime, now, noon, midnight, today, tomorrow, now +valor etc.;
- __opções para at:__
	- '-c' retorna o conteúdo de comandos de um trabalho pelo ID fornecido;
	- '-d' exclui trabalhos por ID, que pode ser consultado com 'atq'; 'at -d' é um alias para 'atrm';
	- '-f' lê o trabalho a partir de um arquivo em vez da entrada padrão;
	- '-l' lista tarefas pendentes; com root, lista inclusive tarefas de outros usuários; é um alias para 'atq';
	- '-m' envia email para o usuário, mesmo se não houver saída;
	- '-q' define uma fila alfabética; quanto maior a letra, maior o valor de nice;
	- '-v' retorna a hora em que o trabalho será executado;
	- '-r' remove um trabalho cujo ID seja informado;
- os agendamentos ficam armazenados no diretório '/var/spool/at' ou '/var/spool/cron/atjobs/', em arquivos com permissão 700 \(somente proprietário e root podem ver, editar e executar);
- o controle de uso do 'at' é feito pelos arquivos '/etc/at.allow' e '/etc/at.deny'.

### atq
- lista as tarefas agendadas com seus IDs.

### atrm
- exclui uma tarefa agendada pelo seu ID respectivo fornecido na sequência, separando por espaço se for mais de um;
- o root pode excluir a tarefa de qualquer usuário.

