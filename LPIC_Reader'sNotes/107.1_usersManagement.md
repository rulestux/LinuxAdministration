## 107.1 Users Management
__weight 5__


### useradd
- cria um novo usuário cujo nome for fornecido no final do comando;
- __opções:__
	- '-c' cria uma nova conta com comentários personalizados;
	- '-d' com diretório pessoal personalizado;
	- '-e' permite definir uma data de expiração da nova conta, quando ela será desabilitada;
	- '-f' define o número de dias até a expiração de uma senha, que deverá ser atualizada ou a conta será desabilitada;
	- '-g' permite especificar GID do grupo primário;
	- '-G' adiciona a grupos secundários separados por vírgulas;
	- '-k' permite especificar um diretório 'skel' personalizado, usada apenas combinada à '-m';
	- '-m' cria um diretório pessoal a partir do 'skel' padrão;
	- '-M' sem diretório inicial;
	- '-s' com um shell de login específico;
	- '-u' permite especificar UID.

### id
- 'id USERNAME' permite consultar UID, GID e o grupo do novo usuário;
- como root, retorna dados do root; para dados de um usuário, fornecer o nome.

### groups
- 'groups USERNAME' permite consultar o grupo do novo usuário.

### passwd
- permite configurar senha do usuário fornecido no fim do comando;
- no caso de um novo usuário, recomenda-se a sintexe: ```# passwd -e USERNAME```;
- a opção '-e' expira a nova senha, forçando o novo usuário criar uma nova no próximo login.
__opções gerais:__
	- '-d' apaga a senha de um usuário, desabilitando a conta;
	- '-e' força a alteração da senha;
	- '-i' define dias de inatividade após a expiração de uma senha, para que ela seja atualizada antes de uma desativação; o valor -1 remove a inatividade;
	- '-l' bloqueia a conta; uma exclamação é inserida antes da senha criptografada no arquivo '/etc/shadow', desabilitando o acesso do usuário;
	- '-n' define um tempo de vida mínimo para a senha; MIN_DAYS;
	- '-S' retorna o status da senha; ver 110.1;
	- '-u' desbloqueia a conta; remove a exclamação em '/etc/shadow', reabilitando o usuário;
	- '-x' define tempo de vida máximo da senha; MAX_DAYS;
	- '-w' define número de dias de aviso antes que uma senha expire.

### chage
- 'change age' é um comando para alterar validade de senhas de um usuário, usado apenas pelo root;
- __opções:__
	- '-d' define última alteração de senha para uma conta fornecida;
	- '-E' define data de expiração para uma conta;
	- '-I' define número de dias de inatividade após expiração; o valor -1 remove a inatividade;
	- '-l' lista informações sobre a expiração da senha, sendo a única forma do comando que pode ser usada por usuários comuns;
	- '-m' define tempo de vida mínimo da senha;
	- '-M' define tempo de vida máximo da senha;
	- '-W' define número de dias de aviso antes que uma senha expire;
- sem as opções, abre-se um prompt para alteração de todas as opções.

### chfn
- altera o campo de comentário \(5º campo) do arquivo '/etc/passwd', com opções, string entre aspas e o nome do usuário a ter os dados alterados;
- __opções:__
	- '-f' '--full-name';
	- '-h' '--home-phone';
	- '-o' '--other-info';
	- '-w' '--work-phone';
- sem as opções, abre-se um prompt para alteração de todas as opções.

### usermod
- permite modificar atributos de um usuário fornecido no final do comando;
- __opções:__
	- '-c' adiciona comentários personalizados;
	- '-d' altera o diretório; combinada à '-m', move o que estiver no diretório pessoal atual para o novo diretório pessoal;
	- '-e' altera data de expiração;
	- '-f' altera a expiração da senha;
	- '-g' altera GID de grupo primário, como useradd;
	- '-G' adiciona a grupos secundários separados por vírgulas, como useradd; sem grupos fornecidos, remove os existentes; combinada à '-a', adiciona os grupos secundários fornecidos que ainda não estiverem configurados;
	- '-l' altera o nome de login;
	- '-L' bloqueia a conta fornecida; uma exclamação é inserida antes da senha criptografada no arquivo '/etc/shadow', desabilitando o acesso do usuário;
	- '-s' altera o shell de login;
	- '-u' altera UID;
	- '-U' remove a exclamação em '/etc/shadow', desbloqueando o usuário.

### userdel
- comando para remover um usuário fornecido na sequência;
- a opção '-r' adiciona recursividade ao comando, removendo o diretório de usuário.

### groupadd
- comando para criar grupos;
- sintaxe de costume: ```# groupadd -g 1090 GROUPNAME```, em que a opção '-g' permite especificar o GID.

### gpasswd
- define senhas de grupo, quando desejado;
- usuários de outros grupos que tiverem a senha podem ingressar temporariamente com o comando '__newgrp__';
- __opções:__
	- '-a' adiciona um usuário fornecido a seguir a um grupo informado no final do comando;
	- '-d' remove usuário do grupo;
	- '-r' remove a senha do grupo;
	- '-R' restringe acesso dos membros ao grupo;
	- '-M' ajusta a lista de membros, com vírgula como separador;
	- '-A' ajusta a lista de administradores, com vírgula como separador.

### groupmod
- comando para modificar grupos;
- sintaxe de costume: ```# groupmod -n WEB-GROUPNAME -g 1050 GROUPNAME```.

### groupdel
- comando que remove um grupo fornecido a seguir;
- para remover um grupo, ele não pode ser grupo principal de usuário algum.

### newgrp
- permite ingressar temporariamente um grupo de que o usuário corrente não faz parte através da senha de grupo;
- quando o grupo não possui senha, apenas usuários que fazem parte dele podem usar o 'newgrp' para usar o grupo como primário temporariamente.

### /etc/skel/
- diretório esqueleto para a criação de diretórios pessoais, que pode ser personalizado.

### /etc/login.defs
- arquivo que especifica os parâmetros de configuração que controlam novos usuários e grupos;
- diretivas importantes:
	- UID_MIN e UID_MAX: intervalo de IDs de usuários;
	- GID_MIN e GID_MAX: intervalo de IDs de grupos;
	- CREATE_HOME: especifica se deve-se criar diretório pessoal;
	- USERGROUPS_ENAB: especifica se deve-se criar grupo primário com o mesmo nome para cada usuário e se o grupo deve ser removido com o usuário;
	- MAIL_DIR: diretório de spool de email;
	- PASS_MAX_DAYS: número máximo de dias que uma senha pode ser usada;
	- PASS_MIN_DAYS: número mínimo de dias entre mudanças de senha;
	- PASS_MIN_LEN: comprimento mínimo de senhas;
	- PASS_WARN_AGE: número de dias de aviso antes que uma senha expire.

### /etc/passwd
- arquivo legível por todos, com 7 campos delimitados por dois pontos, com informações sobre usuários:
	- Nome de Usuário;
	- Senha criptografada ou 'x', caso a senha esteja em '/etc/shadow';
	- UID;
	- GID;
	- GECOS: campo de comentário opcional, que pode conter entradas delimitadas por vírgulas;
	- Diretório HOME;
	- Shell.

### /etc/group
- arquivo legível por todos, com 4 campos delimitados por dois pontos, com informações sobre grupos:
	- Nome do Grupo;
	- Senha criptografada ou 'x', caso a senha esteja em '/etc/gshadow';
	- GID;
	- Lista de Membros.

### /etc/shadow
- arquivo legível apenas pelo root, com 9 campos delimitados por dois pontos, com senhas de usuários criptografadas:
	- Nome de Usuário;
	- Senha criptografada; se começar com '!', o usuário está bloqueado;
	- Data de última mudança da senha;
	- Idade mínima da senha;
	- Idade máxima da senha;
	- Período de aviso de expiração da senha;
	- Período de inatividade da senha;
	- Data de expiração da conta;
	- campo reservado.

### /etc/gshadow
- arquivo legível apenas pelo root, com 4 campos delimitados por dois pontos, com senhas de grupo criptografadas:
	- Nome do grupo;
	- Senha criptografada; se começar com '!', ninguém tem a permissão de acessar com '__newgrp__';
	- Administradores do grupo, delimitados por vírgulas, que podem adicionar ou remover membros e alterar a senha do grupo com 'gpaswd';
	- Membros do grupo.

### getent
- comando para acesar bancos de dados suportados pelas bibliotecas 'Name Service Switch' \(NSS), configurados em '/etc/nsswitch.conf'; ver 109.4;
- fornecendo um ou mais argumentos chave, permite verificar o conteúdo filtrado dos arquivos acima \
(passwd, group e shadow), como fariam cat e grep concatenados com pipe:
	- ```# getent passwd USERNAME```
	- ```# getent group GROUPNAME```

### pwconv
- comando que gera o arquivo '/etc/shadow' a partir de '/etc/passwd';
- 'pwunconv' retorna os dados de '/etc/shadow' para '/etc/passwd' e exclui o primeiro;
- equivalente para grupos: 'grpconv'.