## 102.2 GRUB 2
__weight 2__


### Installation

- em um liveCD carregado, executar:
```
# mkdir /mnt/tmp
# mount /dev/sda1 /mnt/tmp
```
em que 'sda1' deve ser substituído pela identificação da partição com a flag Boot, o que se verifica com ```# fdisk -l /dev/sda```;

- instalando efetivamente em um disco com partição '/boot': 
```# grub-install --boot-directory=/mnt/tmp /dev/sda```
- instalando efetivamente em um disco em que há um diretório '/boot' na raiz do sistema:
```# grub-install --boot-directory=/boot /dev/sda```
- caso necessário, pode-se gerar o arquivo de configuração do GRUB com:
```# grub-mkconfig -o /boot/grub/grub.cfg```

### Configuring GRUB 2
- o arquivo de configuração do GRUB 2 é o '/boot/grub/grub.cfg', mas o arquivo que pode ser alterado para fins de configuração é o '/etc/default/grub';
- após qualquer alteração no '/etc/default/grub', deve-se executar o utilitário 'update-grub', que é um atalho para 'grub-mkconfig -o /boot/grub/grub.cfg';
- parâmetros mais importantes do arquivo '/etc/default/grub':
	- 'GRUB_DEFAULT=' seleciona a o sistema de inicialização padrão a partir do valor '0' ou do nome de um item de menu;
	- 'GRUB_SAVEDEFAULT=' se estiver definida como 'true' e a 'GRUB_DEFAULT=' como 'saved', o padrão de inicialização será o selecionado pela última vez;
	- 'GRUB_TIMEOUT=' tempo limite em segundos;
	- 'GRUB_CMDLINE_LINUX=' lista as opções de linha de comando que serão adicionadas às entradas do Kernel Linux;
	- 'GRUB_CMDLINE_LINUX_DEFAULT=' para inclusão de parâmetros extras apenas à entrada padrão;
	- 'GRUB_ENABLE_CRYPTODISK=' definido como 'y', passa a exigir uma senha para descriptogravar discos.
- o diretório '/etc/grub.d/' contém scripts para mais configurações do GRUB.
	
### Booting with GRUB 2 Shell
- pressionar 'c' ou 'ctrl + c' na tela do GRUB para entrar no shell do GRUB;
usar ```grub> ls``` para encontrar as entradas de disco;
usar ```grub> ls (entrada-de-disco)/``` para localizar o kernel 'vmlinuz' e o arquivo 'initrd.img'; caso não estejam no diretório raiz, verificar no diretório '/boot/';
usar ```grub> set root=(entrada-de-disco)``` para definir a partição de inicialização;
usar ```grub> linux /vmlinuz root=/dev/sda1```, substituindo 'sda1' pela partição correta, para informar ao kernel onde está o sistema de arquivos raiz;
usar ```grub> initrd /initrd.img``` para carregar o disco RAM inicial e em seguida iniciar com ```boot```.

### Booting with 'grub rescue' Shell
usar ```grub rescue> set prefix=(entrada-de-disco)/boot/grub```, seguido de ```grub rescue> insmod normal``` e ```grub rescue> insmod linux```.
