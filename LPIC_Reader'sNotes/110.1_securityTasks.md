## Security Tasks
__weight 3__


### find
- permite encontrar arquivos com permissão especial com as opções:
	- ```-perm numeric-value``` ou ```-perm symbolic-value``` exclusivamente;
	- ```-perm -numeric-value``` ou ```-perm -symbolic-value``` inclusivamente;
	- ```-perm /numeric-value``` ou ```-perm /symbolic-value``` qualquer permissão especial;
	- em que 'numeric-value' pode ser 4000 para SUID ou 2000 para SGID ou /6000 para qualquer; e symbolic-value u+s ou g+s.

### passwd
- com as opções '-S' ou '--status', retorna:
	- login do usuário;
	- 'P' para senha válida, 'L' para senha bloqueada ou 'NP' para nenhuma senha;
	- data da última alteração da senha;
	- idade mínima em dias para alteração da senha; 0 pode ser alterada a qualquer momento;
	- idade máxima em dias de validade da senha; 99999 desabilita expiração;
	- período de aviso em dias para expiração;
	- período de inatividade da senha após a expiração e antes do bloqueio; -1 remove a inatividade;
	- \(campos que coincidem com os 7 primeiros dos 9 do arquivo '/etc/shadow'; ver 107.1);
- outras opções permitem bloquear, desbloquear, forçar alteração de senha e excluir senha: '-l', '-u', '-e' e '-d'.

### usermod
- 'usermod -L' ou 'usermod --lock' bloqueiam usuário fornecido a seguir;
- 'usermod -U' ou 'usermod --unlock' para desbloquear;
- 'usermod -f N' ou 'usermod --inactive N' configura 'N' dias de inatividade após expiração e antes de bloqueio.

### chage
- 'chage -l' ou 'chage --list' listam dados sobre a senha de um usuário fornecido a seguir;
- sem opções, habilita-se o modo interativo:
	- '-m N USERNAME' ou '--mindays N USERNAME' configuram 'N' dias mínimos para alteração da senha; 0 para qualquer momento;
	- '-M N USERNAME' ou '--maxdays N USERNAME' máximo de dias de validade da senha; 99999 para desabilitar expiração;
	- '-d N USERNAME' ou '--lastday N USERNAME' especificam 'N' dias até a senha expirar; 0 força alteração no próximo login;
	- '-W N USERNAME' ou '--warndays N USERNAME' 'N' dias de aviso de senha expirada;
	- '-I N USERNAME' ou '--inactive N USERNAME' para 'N' dias de inatividade, feito '-f' e '--inactive' de usermod; 0 para desabilitar o bloqueio;
	- '-E YYYY-MM-DD USERNAME' ou '--expiredate YYYY-MM-DD USERNAME' especificam data de bloqueio da conta.

### lsof -i
- lista arquivos usados pela rede da 'internet';
- pode-se incluir o IP de um host para filtrar: 'lsof -i@192.168.1.7';
- ou porta: 'lsof -i :22';
- ou uma ou mais portas de um host específico: 'lsof -i@192.168.1.7:22,80';
- __outras opções além de -i:__
	- '-u' filtra por um usuário fornceido a seguir;
	- '-c' filtra por um comando.

### fuser
- exibe usuário de arquivo;
- verifica o diretório atual com ```# fuser . ```;
- com a opções '-v', lista colunas:
	- nome do arquivo;
	- USER: proprietário;
	- PID: ID do processo;
	- ACCESS: tipo de acesso:
		- 'c' diretório atual;
		- 'e' executável em execução;
		- 'f' arquivo aberto para leitura;
		- 'F' arquivo aberto para escrita;
		- 'r' diretório raiz;
		- 'm' arquivo mmap ou biblioteca compartilhada;
		- '.' espaço reservado;
	- COMMAND: comando afiliado ao arquivo;
- com as opções '-n' ou '--namespace' pode-se especificar protocolo e porta/socket de rede:
 ```# fuser -vn tcp 80 ``` retorna informações sobre o servidor Apache;
- com as opções '-k' ou '--kill' elimina os processos que estão acessando o arquivo.

### netstat
- exibe conexões ativas de rede e sockets Unix;
__opções:__
	- '-a' para todas;
	- '-l' ou '--listening' filtram por portas/sockets ouvintes \(portas abertas); 
	- '-t' ou '--tcp' filtram pelo protocolo TCP;
	- '-u' ou '--udb', pelo UDP; 
	- '-e' ou '--extend' exibem mais detalhes;
	- '-n' ou '--numeric' retornam números de portas e endereços, no lugar de nomes.

### nmap
- mapeador de rede que escaneia portas especificando IP ou nome de host;
- pode-se especificar mais de um, com espaços, ou intervalos, com '-', ou subredes, com '*' ou CIDR;
- '-p' permite especificar uma porta para escanear, fornecendo número ou nome;
- '-F' executa escaneamento rápido das 100 portas mais comuns;
- '-v' para saída detalhada; '-vv' para ainda mais detalhes.

### ulimit
- utilitário que retorna blocos de arquivos flexíveis do usuário corrente;
- __opções:__
	- '-S' especifica os flexíveis \(soft);
	- '-H' especifica os rígidos \(hard);
	- '-a' retorna todos os limites flexíveis atuais; o mesmo que '-Sa';
	- '-Ha' para todos os limites rígidos;
	- para recursos do Shell:
		- '-b' tamanho máximo do buffer socket;
		- '-f' tamanho máximo de arquivos escritos pelo shell e seus processos-filhos;
		- '-l' tamanho máximo da memória que pode ser bloqueada;
		- '-m' tamanho máximo do conjunto residente \(RSS, resident set size) para um processo na RAM;
		- '-v' quantidade de memória virtual;
		- '-u' número máximo de processos disponíveis para um usuário;
- __sintaxe:__ '-f' seguido de um valor em kilobytes ou 'unlimited' define um limite de blocos para '-S' ou '-H' ou para ambos, se não especificar.

### /etc/security/limits.conf
- arquivo que mantém as configurações de limite, o qual deve ser alterado para que as configurações de limite sejam permanentes; pode haver o diretório '/etc/security/limits.d/';
- o arquivo contém orientações para o preenchimento das colunas; 
- pode-se atribuir configuarção para usuário ou grupo, este último precedido por '@'.

### last
- comando que retorna uma lista detalhada dos últimos usuários logados e suas sessões;
- seguido de um nome de usuário, last retorna suas respectivas sessões;
- a coluna após o nome de usuário na lista indica o terminal: pts significa 'Pseudo Terminal Slave', oposto a tty, 'TeleTypeWriter';
- os dados são extraídos do arquivo '__/var/log/wtmp__';
- __lastb__ exibe tentativas de login incorretas; dados de '__/var/log/btmp__';
- a opção '-f' para last e lastb permite selecionar outros arquivos wtmp e btmp gerados pelo logrotate.

### who
- exibe usuários atualmente logados, com dados extraídos do binário '/var/log/wtmp';
- __opções:__
	- '-b' ou '--boot' exibem a hora da última inicialização do sistema;
	- '-r' ou '--runlevel' exibe o nível de execução atual;
	- '-H' ou '--heading' exibe o cabeçalho das colunas;
	- '-a' para mais detalhes;
- a coluna após o nome de usuário na lista indica o terminal: pts significa 'Pseudo Terminal Slave', oposto a tty, 'TeleTypeWriter', ':0' para o modo gráfico.

### w
- exibe usuários logados, com dados extraídos do binário '/var/log/wtmp', detalhando:
	- hora atual e tempo de atividade do sistema;
	- os 3 números médios de carga \(load average);
	- oito colunas com usuários e suas ações:
		- USER: nome de usuário;
		- TTY: nome do terminal;
		- FROM: IP do host remoto;
		- LOGIN@: tempo de login;
		- IDLE: tempo ocioso;
		- JCPU: tempo usado por todos os processos ligados ao tty, incluindo trabalhos em segundo plano;
		- PCPU: tempo usado pelo processo atual;
		- WHAT: processo atual;
- pode-se passar nome de usuário para especificá-lo, como com who.

### su
- 'switch user' é o comando que permite a troca de usuário;
- com a sintaxe ```su - ``` garante o carregamento do ambiente do usuário destino: ler arquivo '.profile' e ir para o respectivo diretório home;
- sem fornecer o nome de usuário, o padrão é mudar para 'root';
- com a opção '-c', permite executar um comando com o privilégio de outro usuário fornecido.

### /etc/sudoers
- arquivo que, em conjunto com outros do diretório '/etc/sudoers.d', lista usuários que têm privilégios de uso do comando '__sudo__', cuja sintaxe padrão é: 
 ```$ sudo -u USERNAME COMMAND ```;
- __sintaxe do arquivo '/etc/sudoers':__
	- ``` usuário host=(usuário:grupo) comando ```;
	- exemplo: ``` root	ALL=(ALL:ALL) ALL ```;
	- leia-se: o usuário root pode se logar com todos os hosts, em nome de todos os usuários e todos os grupos, além de executar todos os comandos;
	- palavras úteis:
		- 'NOPASSWD:' dispensa a necessidade de autenticação;
- sudoers podem ser adicionados com o comando: ```# usermod -aG sudo USERNAME``` ou ```# useradd -aG sudo USERNAME ```;
- o arquivo '/etc/sudoers' costuma ser editado pelo comando ```# visudo ```
- linhas possíveis:
	- ``` Defaults 	timestamp_timeout=N ``` define o tempo limite de uso do 'sudo' para 'N' minutos; o padrão assumido sem essa linha é 15 min.;
	- ``` Defaults 	editor=/usr/bin/nano ``` define o 'nano' como editor padrão para visudo;
	- 'User_Alias', 'Host_Alias' e 	'Cmnd_Alias' podem ser definidos no arquivo '/etc/sudoers' com listas de nomes, IPs e caminhos absolutos separados por vírgulas.
