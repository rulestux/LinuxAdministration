## 104.2 Filesystem Maintenance
__weight 2__


### du
- comando que retorna quantos blocos de 1 kilobyte estão sendo usados pelo diretório atual e pelos seus subdiretórios;
- __opções:__
	- '-h' retorna uma descrição mais humanizada, em megabytes, gigabytes etc.;
	- '-a' retorna uma contagem individual para cada arquivo contido no diretório e subdiretórios;
	- '-S' retorna o espaço utilizado pelo diretório atual menos os subdiretórios;
	- '-Sc' inclui o total;
	- '-dN' define a profundidade dos resultados, em que 'N' é um inteiro com a profundidade;
	- '--exclude="PATTERN"' exclui arquivos da contagem em que 'PATTERN' é o padrão a ser correspondido, por exemplo:
	```$ du -ah --exclude="*.bin" ``` exclui da contagem todos os arquivos da extensão '\*.bin'.

### df
- comando que retorna uma lista de dados dos sistemas de arquivos montados;
- __opções:__
	- '-h' retorna uma descrição mais humanizada, em megabytes, gigabytes etc.;
	- '-i' retorna por inodes, em vez de blocos;
	- '-T' inclui uma coluna com o tipo do sistema de arquivos de cada dispositivo montado;
	- '-t' filtra os resultados por um determinado tipo de sistema de arquivos fornecido;
	- '-x' filtra os resultados excluindo os dispositivos de um determinado tipo fornecido;
	- '--output=FIELD' seleciona os campos de colunas que se desejam no retorno, separados por vírgula:
		- ``` $ df -h --output=target,source,fstype,size,used,avail,pcent ``` retorna as colunas equivalentes;
		- outros campos podem ser: itotal, iused, iavail e ipcent, que retornam resultados por inode.

### fsck
- utilitário de verificação e correção do sistema de arquivos;
- sua sintaxe é ```# fsck /dev/sdb1 ```;
- o fsck deve ser usado somente em sistemas de arquivos não montados, sob pena de perda de dados;
- sem especificar o sistema de arquivos, o fsck chama o e2fsck, próprio para sistemas do tipo ext2/3/4;
- __opções:__
	- '-t' especifica o tipo do sistema de arquivos da partição fornecida a seguir;
	- '-A' verifica todos os sistemas de arquivos listados em '/etc/fstab';
	- '-C' exibe uma barra de progresso no caso dos sistemas ext2/3/4;
	- '-N' modo de teste, que apenas simula a verificação;
	- '-R' com '-A', pula a verificação do sistema de arquivos raiz;
	- '-V' modo detalhado, verboso;
	- '-p' tenta corrigir automaticamente os erros;
	- '-y' responde 'yes' a todas as interações;
	- '-n' oposto de '-y';
	- '-f' força a verificação.

### tune2fs
- utilitário de verificação e ajuste de parâmetros dos sistemas de arquivo ext2/3/4;
- sintaxe: ```# tune2fs -l /dev/sda1```;
- __opções:__
	- '-l' lista os parâmetros de uma partição;
	- '-c N' altera a contagem máxima de montagens até a próxima verificação automática, em que 'N' é o número de montagens;
	- '-C N' altera o status da contagem atual;
	- '-i' define o intervalo de tempo para verificações, com sub-opções feito '-i 1d' para dias, '-i 1m' para meses e '-i 1y' para anos;
	- '-L' define um rótulo de até 16 caracteres para o sistema de arquivos;
	- '-U' define um UUID;
	- '-m' define o percentual do sistema de arquivos exclusivo para operações com root;
	- '-e' define um comportamento do kernel quando um erro é encontrado, sendo possíveis:
		- 'continue' para continuar a execução normalmente;
		- 'remount-ro' para remontar como somente leitura, evitando mais erros;
		- 'panic' para causar um 'kernel panic';
	- '-j' acrescenta o recurso 'journal' a um sistema de arquivos ext2, convertendo-o em um ext3;
	- '-J' permite definir opções do uso do 'journal':
		- '-J size=' define o tamanho do diário em megabytes;
		- '-J location=' permite especificar o local do armazenamento do diário;
		- '-J device=' permite selecionar o dispositivo onde armazenar o diário;
		- podem-se especificar diversos parâmetros simultaneamente separados por vírgula;
	- '-f' força a completar uma operação, mesmo que sejam encontrados erros; cautela!
	
### xfs_repair
- é o equivalente ao fsck para o sistema de arquivos XFS;
- sintaxe: ```# xfs_repair -n /dev/sdb1 ```;
- __opções:__
	- '-n' verifica se há erros, sem ações de reparação; caso haja erros, executar o utiliário sem o parâmetro para corrigir;
	- '-v' modo verboso; '-v -v' ainda mais detalhes são exibidos;
	- '-d' modo dangerous, para reparar sistemas montados como somente leitura;
	- '-m N' permite limitar em N megabytes o uso de memória pelo utilitário;
	- '-l LOGDEV' e '-r RTDEV' para sistemas com logo externo e seções em tempo real.