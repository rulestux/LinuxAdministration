## 105.1 Shell Environment
__weight 4__


### bash
- como comando, inicia um shell filho, seja em um pts \(pseudo terminal slave - emulador de terminal) ou em um tty \(teletypewritter); 
- para abrir um console tty, pode-se usar as combinações ctrl+alt+F1-F6; ctrl+alt+F7 retorna ao desktop;
- __opções para o comando bash:__
	- '-l' ou '--login' invocam um shell de login;
	- '-i' invoca um shell interativo;
	- '--noprofile' em shell de login, ignora arquivos feito '/etc/profile' de sistema e '~/.bash_profile', '~/.bash_login' e '~/.profile' de usuário;
	- '--norc' em shell interativo, ignora arquivos feito '/etc/bash.bashrc' de sistema e '~/.bashrc' de usuário;
	- '--rcfile' em shell interativo, considera o arquivo fornecido a seguir como arquivo de inicialização, no lugar de arquivos de sistema e arquivos de usuário.

### su
- comando com o qual se pode chamar shell de login ou sem login;
	- ```# su - user2```, ```# su -l user2``` ou ```# su --login user2``` iniciam shell de login interativo como 'user2';
	- ```# su user2``` inicia um shell sem login interativo como 'user2';
	- ```# su - root``` ou ```# su -``` iniciam um shell de login interativo como root;
	- ```# su root``` ou ```# su``` iniciam um shell interativo sem login como root.

### sudo 
- permite que usuário constante no arquivo 'sudoers' possa executar comandos como superusuário temporariamente;
- para incluir usuário entre os 'sudoers':
	- ```# usermod -aG sudo USERNAME``` ou ```# useradd -aG sudo USERNAME ```;
- pode-se iniciar shells de login interativo e sem login interativo usando 'sudo' seguindo adiante conforme a sintaxe acima; porém para os outros casos:
	- ```$ sudo su -u user2 -s``` para iniciar shell sem login interativo;
	- ```$ sudo -i``` para shell de login interativo como root;
	- ```$ sudo -i <command>``` para um shell de login interativo como root retornando ao usuário original após a execução do comando.
	- ```$ sudo su root``` ou ```$ sudo su``` iniciam um shell sem login interativo como root;
	- ```$ sudo -s``` ou ```$ sudo -u root -s``` iniciam um shell sem login como root.

### echo $0
- varável que contém o tipo de shell, que pode retornar:
	- '-bash' ou '-su' interativo de login;
	- 'bash' ou '/bin/bash' interativo sem login;
	- 'nome_de_script' não interativo.

### ps aux | grep bash
- comando que retorna os shells do bash ativos no sistema.

### source
- comando que executa scripts num mecanismo chamado sourcing;
- ```source``` equivale a ``` . ```.

### adduser
- adiciona novo usuário cujo nome for fornecido a seguir;
- alternativamente: ```# useradd -m USERNAME```.

### deluser
- remove usuário cujo nome for fornecido a seguir;
- normalmente com a sintaxe: ```# deluser --remove-home USERNAME```;
- alternativamente: ```# userdel -r USERNAME```.


## Configuration Files


### /etc/profile
- nível global, para shell de login interativo: busca e executa '/etc/bash.bashrc' e os que estiverem no diretório '/etc/profile.d'.

### /etc/profile.d/*
- nível global, para shell de login interativo: diretório para scripts a serem executados pelo '/etc/profile'.

### ~/.bash_profile
- nível local, para shell de login interativo: configura ambiente de usuário;
- também pode ser usado para executar '~/.bash_login' e '~/.profile'.

### ~/.bash_login
- nível local, para shell de login interativo: só é executado se não houver um '~/.bash_profile';
- executa comandos necessários para o login.

### ~/.profile
- nível local, para shell de login interativo: só é gerado se não existirem os dois anteriores;
- caso um shell bash esteja sendo executado, este script busca o arquivo '~/.bashrc' para executar;
- normalmente, ele define a variável 'PATH' para que inclua o diretório privado '~/bin', caso exista.

### ~/.bash_logout
- nível local, para shell de login interativo: caso exista, realiza operações de limpeza ao sair do shell.

### /etc/bash.bashrc
- nível global, para shell interativo sem login: verifica o tamanho da janela após cada comando, atualizando linhas e colunas, e define algumas variáveis.

### ~/.bashrc
- nível local, para shell interativo sem login: além das funções do arquivo acima, em nível de usuário, define variáveis de histórico, busca e excuta '~/.bash_aliases', caso exista, além de poder armazenar aliases;
- também é lido quando o bash detecta o stdin de uma conexão segura de rede \(SSH).

- IMPORTANTE: arquivos locais têm precedência sobre globais.

### Non Interactive Shells
- com as opções '-l' ou '--login', um shell não interativo é forçado a se comportar como um shell de login.

### $SKEL
- variável que contém o caminho absoluto para o diretório 'skel', o qual serve de esqueleto para a estrutura de diretórios de usuários;
- a variável é definida no arquivo de configuração do adduser '/etc/adduser.conf'.


## Variables, Aliases and Functions


### readonly
- cria, transforma ou mostra variáveis imutáveis;
- 'readonly -p' lista as variáveis imutáveis.

### set
- lista todas as variáveis e funções do shell atual.

### unset
- com '-v' desconfigura uma variável;
- com '-f' para desconfigurar função.

### export
- exporta uma variável local para os subshells;
- 'export -n' retorna uma variável ao status local;
- 'export -p' lista todas as variáveis de ambiente;

### declare
- 'declare -x' equivale a export;
- 'declare -f' lista funções.

### printenv
- assim como 'env', 'printenv' imprime na tela as variáveis de ambiente;
- 'printenv' também pode ser usado para imprimir o conteúdo de uma variável fornecida, mas diferente de 'echo', 'printenv' mostra o conteúdo da variável sem precisar do método de referenciamento com '$'.

### env
- com '-u' desconfigura uma variável de ambiente fornecida a seguir;
- 'env -i bash' inicia uma sessão do shell sem a maioria das variáveis de ambiente;
- 'env' antecedendo a declaração de uma variável, prepara-a para uso exclusivo em um script:
 ```# env DADOS='/var/log/syslog' bash /usr/local/bin/new_data.sh```.

### alias
- comando que retorna aliases disponíveis ou permite criar novos;
- para desconfigurar um alias, usa-se __unalias__.

### $DISPLAY
- variável relacionada ao servidor X, em que se pode configurar um host para exibir janelas gráficas do host atual; ver 106.1.

### $HISTCONTROL
- variável que controla quais comandos são salvos em $HISTFILE;
- valores possíveis:
	- 'ignorespace': não salva comandos iniciados por espaço;
	- 'ignoredups': não salva comandos iguais;
	- 'ignoreboth': não salva ambos.

### $HOSTTYPE
- armazena a arquitetura do processador do hospedeiro.

### $LD_LIBRARY_PATH
- armazenda diretórios de bibliotecas compartilhadas separados pelo delimitador ':'.

### $PS1
- prompt; 
- $PS2 para comandos com muitas linhas;
- $PS3 para o comando 'select';
- $PS4 para depuração, com '+' como conteúdo.

### Bash Built-in Variables
- $? referencia o resultado do último comando, sendo '0' sucesso;
- $$ expande-se para o PID do shell;
- $! expande-se para o PID do último trabalho em segundo plano;
- $0 expande-se para o nome do shell ou script; os valores acima de '0' expandem para as posições de parâmetros ou argumentos;
- $# expande-se para o número de argumentos;
- $@ ou $* expandem-se para todos os argumentos;
- $_ expande-se para o último parâmetro ou nome, caso não existam parâmetros.
