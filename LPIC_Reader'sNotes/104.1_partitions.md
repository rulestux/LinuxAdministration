## 104.1 Partitions
__weight 2__


### fdisk
- utilitário padrão para gerenciar partições MBR - Master Boot Record;
- para editar uma tabela de partição no disco 'sda':
	- ```# fdisk /dev/sda```
- __opções importantes:__
	- '-l' lista os discos ou partições em um disco fornecido;
	- 'm' menu de ajuda com as opções de interação do fdisk;
	- 'p' detalha informações a respeito do disco selecionado;
	- 'n' cria uma nova partição;
	- 'f' exibe o espaço ainda não alocado;
	- 'd' remove uma partição;
	- 't' seguido pelo número de uma partição permite alterar seu tipo; os tipos são identificados por códigos hexadecimais:
		- '83' para partições Linux;
		- '82' para partições Swap;
		- '8e' para partições Linux LVM;
		- '5' para partições estendidas;
		- para ver mais tipos de partições, usar a opção 'l';
	- 'q' sai do utilitário sem escrever nada em disco;
	- 'w' escreve as alterações em disco.

### gdisk
- utilitário para gerenciar partições GUID - GPT;
- para editar uma tabela de partição no disco 'sda':
	- ```# gdisk /dev/sda```
- __opções importantes:__
	- '?' ou 'h' para o menu de ajuda;
	- 'p' detalha informações a respeito do disco selecionado;
	- 'o' cria uma nova tabela de partições GUID - GPT;
	- 'n' cria uma nova partição;
	- 'l' exibe os tipos de partições suportados;
	- 'd' remove uma partição;
	- 't' seguido pelo número de uma partição permite alterar seu tipo; os tipos são identificados por códigos hexadecimais:
		- '8300' para partições Linux;
		- '8200' para partições Swap;
		- '8e' para partições Linux LVM;
		- para ver mais tipos de partições, usar a opção 'L';
	- 'q' sai do utilitário sem escrever nada em disco;
	- 'w' escreve as alterações em disco.
	
### mke2fs
- utiliário básico para a formatação em sistemas de arquivos ext;
- a sintaxe mke2fs básica é ```# mke2fs -t ext4 /dev/sda1```;
	- sem informar o tipo com '-t', o mke2fs formata ext2;
	- sem informar o tipo com a opção '-j', o mke2fs formata no primeiro formato com 'journal' ext3;
	- as configurações do 'mke2fs' podem ser verificadas no arquivo '/etc/mke2fs'.
	
### mkfs.ext4
- os utilitários mkfs.ext2, mkfs.ext3 e mkfs.ext4 são links simbólicos para padrões de funcionamento do formatador de sistema de arquivos __mke2fs__.
- a sintaxe de uso é ```# mkfs.ext4 /dev/sda1```;
- __parâmetros e opções:__
	- '-b SIZE' define o tamanho dos blocos, em que SIZE pode ser de 1024, 2048 ou 4096 por bloco;
	- '-c' verifica se a partição tem blocos defeituosos; '-c -c' faz uma verificação lenta;
	- '-d DIRECTORY' copia o conteúdo de um diretório específico para a raiz de um novo sistema de arquivos;
	- '-F' força a criação de um sistema de arquivos; '-F -F' força mesmo em dispositivos montados, apagando seu conteúdo original;
	- '-L VOLUME_LABEL' define um rótulo de volume de ao menos 16 caracteres;
	- '-n' modo teste que simula a criação de um sistema de arquivos;
	- '-q' modo silencioso, executa a formatação sem produzir saída para o terminal; útil para scripts;
	- '-V' modo verboso;
	- '-U' permite especificar UUID para uma partição; 'clear' limpa o ID existente, 'random' atribui um randômico e 'time' cria um UUID baseado em tempo.

### mkfs.xfs
- 'xfs' é o sistema de arquivos padrão  de distribuições feito RedHat 7;
- __opções:__
	- '-b size=VALUE' define o tamanho do bloco em bytes, sendo o mínimo 512, 4096 o padrão e 65536 o máximo;
	- '-m uuid=VALUE' define UUID da partição;
	- '-f' força a criação de um sistema de arquivos xfs;
	- '-l logdev=DEVICE' define o dispositivo da seção log;
	- '-l size=VALUE' define o tamanho da seção log;
	- '-q' modo silencioso;
	- '-L LABEL' define um rótulo no máximo 12 caracteres;
	- '-N' equivale ao '-n' de 'mke2fs', simulando a formatação.

### parted
- editor de partições para MBR e GPT;
- para editar uma tabela de partição no disco 'sda':
	- ```# parted /dev/sda```
- para mudar o disco selecionado:
	- ```# select /dev/sdb```
- __comandos:__
	- 'print' exibe as partições existentes no disco selecionado;
	- 'print devices' lista todos os dispositivos de bloco conectados ao sistema;
	- 'print all' exibe mas informações sobre os dispositivos;
	- 'print free' exibe o espaço livre nos dispositivos;
	- 'mklabel' cria uma tabela de partições, seguido do tipo:
		- 'mklabel msdos' para MBR;
		- 'mklabel gpt' para GPT;
	- 'mkpart' cria uma partição, seguindo a sintaxe: 'mkpart PARTTYPE FSTYPE START END', em que:
		- PARTTYPE é o tipo, que pode ser 'primary', 'logical' ou 'extended', no caso MBR;
		- FSTYPE é o rótulo do sistema de arquivos - 'file system';
		- START é o ponto onde a partição se inicia, que pode ser dado como:
			- '2s' para o segundo setor,
			- '1m' para o primeiro megabyte,
			- '1024B' para a quantidade em bytes ou
			- '0%' para o percentual de disco;
		- END especifica o ponto onde a partição termina, usando as mesmas unidades de START;
	- 'rm' remove a partição cujo número for fornecido a seguir;
	- 'rescue START END' recupera uma partição acidentalmente removida, informando os pontos aproximados de início e fim;
	- 'resizepart PARTNUMBER NEWEND' redimensiona uma partição desmontada e com espaço livre após seu final;
		- uma vez redimensionada, a partição precisa ter seu sistema de arquivos ampliado com o utilitário 'resize2fs':
			``` $ sudo resize2fs /dev/sdb3 ```
		- o procedimento inverso, com resize2fs e resizepart reduz uma partição;
		``` # resize2fs /dev/sdb3 90m
			# parted /dev/sdb3
			resizepart 3 300m ```
	- 'quit' para sair do utilitário.