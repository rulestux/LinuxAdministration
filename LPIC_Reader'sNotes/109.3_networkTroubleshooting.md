## 109.3 Network Troubleshooting
__weight 4__


### ifconfig
- comando legado, ainda fornecido pelo pacote '__net-tools__';
- sem opções, o comando exibe as interfaces de rede ativas:
	- RX linha que mostra a taxas de recebimento de pacotes,
	- TX taxas de transmissão de pacotes;
- com o nome de uma interface, um IPv4 e máscara CIDR e 'add', permite configurar um IP;
- __opções e subcomandos:__
	- '-a' exibe todas as interfaces, incluindo inativas;
	- 'add' precede a adição de um endereço IPv6;
	- 'netmask' precede a inserção de uma máscara de rede;
	- 'down' ou 'up' após o nome de uma interface desativa ou ativa, respectivamente;
	- 'mtu' permite ajustar o 'Maximum Transmission Unit' \(MTU) de uma interface fornecida.

### ip
- comando completo para gerenciamento de configurações de rede;
- __objetos, opções e subcomandos:__
	- 'address', 'addr', 'a' ou 'ip-address' equivalem a 'ifconfig -a';
	- 'link' lista links de interface;
	- 'add' adiciona IPv4 ou IPv6;
	- 'dev' especifica uma interface pelo nome fornecido a seguir;
	- 'link' configura interface de baixo nível, protocolos VLANs, ARP ou MTUs e permite desabilitar uma interface:
		- 'ip link set IFACE_NAME down' desativa uma interface; up para ativar;
		- 'ip link show' lista as interfaces com detalhes; pode se especificar para obter detalhes dela;
		- 'ip link set IFACE_NAME mtu 2000' permite ajustar o MTU de uma interface;
	- '__ip route__' equivale a '__netstat -r__' e '__route__', retornando uma tabela de roteamento; para IPv6: '__ip -6 route__', '__netstat -6r__' e '__route -6__', respectivamente; 'via' é a palavra que antecede a adição do IP de um roteador \(gateway) com 'ip route'.

### netstat
- utilitário que retorna status de conexões;
- __opções:__
	- '-a' exibe os status de cada conexão;
	- '-e' exibe o usuário dos processos que estão requisitando as conexões;
	- '-i' exibe dados de interfaces de rede;
	- '-n' exibe IPs, sem resolução de nomes;
	- '-p' exibe o processo local que está requisitando as conexões;
	- '-t' filtra por conexões TCP;
	- '-u' filtra por conexões UDP.

### route
- comando que retorna uma tabela de dados de rotas da rede local e permite editar rotas, feito 'ip route';
- __palavras-chave__:
	- 'add' antecede a adição de um IP;
	- 'gw' antecede a adição do IP de um roteador \(gateway).

### /sys/class/net/
- diretório que também armazena arquivos relacionados com interfaces de rede.

### ping
- comando que permite testar uma conexão, com eco ICMP; 
- '__ping6__' é o equivalente para IPv6;
- sintaxe comum: ```$ ping -c 3 192.168.50.2```, em que '-c 3' limita o teste ao envio de 3 pacotes.

### traceroute
- utilitário que retorna a rota de um pacote até um destino fornecido a seguir pelo IP;
- '__traceroute6__' é o equivalente para IPv6;
- cada reteador no caminho responde com uma mensagem ICMP de Time-To-Live \(TTL) excedido;
- são enviados 3 pacotes UDP com dados inúteis para a porta 33434, que são incrementados a cada vez que são enviados;
- o comando retorna uma linha para cada roteador que os pacotes atravessam, com o IP de cada interface e o tempo de ida e volta dos pacotes;
- quando retorna '*' no lugar do tempo, significa que a mensagem TTL excedido para um pacote não foi recebida;
- a opção '-I', usada como root, substitui solicitações de eco UDP por ICMP, que são mais eficazes;
- a opção '-T -p 80', como root, solicita eco TCP, em que '-p' especifica a porta; esta opção é útil, considerando que respostas ICMP podem estar bloqueadas.

### tracepath
- semelhante ao 'traceroute', mas rastreia tamanhos de 'Maximum Transmission Unit' \(MTU) pelo caminho, enviando pacote com datagrama UDP extenso;
- o MTU é uma configuração de interface ou limite de hardware para a maior unidade de dado de protocolo que é possível transmitir ou receber;
- '__tracepath6__' é o equivalente para IPv6.

### nc
- '__netcat__' permite testar conexões; ver 108.3;
- __opções:__
	- '-l' recebe dados, em vez de enviar;
	- '-u' UDP;
	- '-e' instrui a encaminhar tudo o que recebe para a entrada padrão de um executável fornecido a seguir.

### ss
- 'socket service', assim como o legado '__netstat__', retorna o status de *listeners* e conexões atuais;
- __opções:__
	- '-a' exibe todos os sockets;
	- '-l' sockets de escuta;
	- '-p' processos associados à conexão;
	- '-n' bloqueia pesquisas de nome para portas e endereços;
	- '-t' mostra conexões TCP;
	- '-u' mostra conexões UDP;
- 'netstat' e 'ss', com as devidas opções \(normalmente -tulnp), retornam as colunas:
	- Recv-Q: número de pacotes que um socket recebeu, mas não passou para seu programa;
	- Send-Q: número de pacotes que um socket enviou e não foram confirmados pelo receptor.